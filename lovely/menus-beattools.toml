[manifest]
dump_lua = true
priority = 0
version = "1.0.0"

# Silly nisenen gimmick ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''Event.property(event,'string', 'easeSequence', 'Ease sequence to use, if any', {optional = true, default = ''})'''
payload = '''
if mods.beattools.config.sillyNisenenGimmick then
	Event.property(event, "bool", "sillyNisenenGimmick", "Randomizes angles for bounces\nOverrides rotation with a high value", { optional = true, default = true })
end
'''
position = "after"
target = "levelformat/events/Notes/bounce.lua"

# Cheat in results ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''cs.songOffset = 0'''
payload = '''self.CHEATlagBack = 0'''
position = "before"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''cs.levelinfo = self.levelinfo'''
payload = '''cs.CHEATlagBack = self.gm.CHEATlagBack'''
position = "after"
target = "states/Game.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''savedata.options.accessibility.sides ~= 'default' or'''
payload = '''self.CHEATlagBack ~= 0 or'''
position = "before"
target = "states/Results.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''local textWidth = fonts.digitalDisco:getWidth(str)'''
payload = '''
if self.CHEATlagBack ~= 0 then
	if str ~= '' then str = str .. ', ' end
	str = str .. "Lagged " .. self.CHEATlagBack .. " times"
end
'''
position = "before"
target = "states/Results.lua"

# Hide menus ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''self:imgui()'''
payload = '''
if not beattoolsRecordPosition then self:imgui() beattoolsRandomizeWindows = false end
for i = 1, 7 do
	if mods.beattools.config.currentPaddle then
		beattoolsGetCurrentEasing(self, "paddles", "enabled", "editorBeat", i, "enabled")
		beattoolsGetCurrentEasing(self, "paddles", "newWidth", "editorBeat", i, "newWidth")
		beattoolsGetCurrentEasing(self, "paddles", "newAngle", "editorBeat", i, "newAngle")
		self.p.paddles[i].enabled = beattoolsCurrentEasings.editorBeat.paddles[i].enabled.enabled
		self.p.paddles[i].paddleSize = beattoolsCurrentEasings.editorBeat.paddles[i].newWidth.newWidth
		self.p.paddles[i].baseAngle = beattoolsCurrentEasings.editorBeat.paddles[i].newAngle.newAngle
	else
		self.p.paddles[i].enabled = i == 1
		self.p.paddles[i].paddleSize = 70
		self.p.paddles[i].baseAngle = 0
	end
end
'''
position = "at"
target = "states/Editor.lua"

# Combo adjust ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''if imgui.BeginCombo(imguiUniqueName, event[propertyName]) then'''
payload = '''if imgui.BeginCombo(imguiUniqueName, event[propertyName], mods.beattools.config.betterCombo and 2^4 + 2^5 + 2^7 or nil) then'''
position = "at"
target = "obj/GameManager.lua"

# Ctrl + i menu resize ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''9999)'''
payload = '''9999, mods.beattools.config.fullSize and "max" or nil)'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''function helpers.InputTextMultiline(label, text, size)'''
payload = '''
function helpers.InputTextMultiline(label, text, size, size2)
	if size2 ~= nil and size2:sub(1, 3) == "max" then
		local lines = 1
		for _ in text:gmatch("\n") do
			lines = lines + 1
		end
		size2 = imgui.ImVec2_Float(
			utilitools.imguiHelpers.getWidth(label) - (size2 == "maxTooltip" and (not mods.beattools.config.hideHelpMarkers) and 29 or 0),
			imgui.GetFontSize() * lines + 6
		)
	end
'''
position = "at"
target = "lib/imguihelper.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''imgui.InputTextMultiline(label, buffer, size)'''
payload = '''imgui.InputTextMultiline(label, buffer, size, size2)'''
position = "at"
target = "lib/imguihelper.lua"

# Input resize ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''local enabled = true'''
payload = '''
local label = mods.beattools.config.shortenParams and mods.beattools.config.keysWhiteList[imguiUniqueName] ~= true and mods.beattools.config.keysWhiteList[imguiUniqueName] or (((propertyType == 'decimal') or (propertyType == 'int')) and propertyName or imguiUniqueName)
local length = utilitools.imguiHelpers.getWidth(imguiUniqueName) - ((not mods.beattools.config.hideHelpMarkers) and 29 or 0)
'''
position = "after"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''imgui.PushItemWidth(100)'''
payload = '''if not mods.beattools.config.fullSize then imgui.PushItemWidth(mods.beattools.config.inputSize) else imgui.PushItemWidth(length) end'''
position = "at"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''
local truncatedResult = math.floor(1000*result+0.5)/1000
local truncatedProperty = math.floor(1000*propertyOld+0.5)/1000
'''
payload = '''
local precision = mods.beattools.config.preciseTimeInput and imguiUniqueName == "time" and 1e12 or 1e3
local truncatedResult = math.floor(precision * result + 0.5) / precision
local truncatedProperty = math.floor(precision * propertyOld + 0.5) / precision
'''
position = "at"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''
imgui.SameLine()
imgui.Text(propertyName)
'''
payload = '''
imgui.SameLine()
imgui.Text(label)
'''
position = "at"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''numptr = ffi.new('char[' .. propertyLength .. ']', string.format("%.3f", event[propertyName]))'''
payload = '''numptr = ffi.new('char[' .. propertyLength .. ']', string.format(mods.beattools.config.preciseTimeInput and imguiUniqueName == "time" and "%.12f" or "%.3f", event[propertyName]))'''
position = "at"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''imgui.PushItemWidth(60)'''
payload = '''if not mods.beattools.config.fullSize then imgui.PushItemWidth(mods.beattools.config.inputSize) else imgui.PushItemWidth(length * 1 - 4 * 2 - 19 * 2 + imgui.GetStyle().ItemInnerSpacing.x - imgui.GetStyle().ItemSpacing.x) end -- Penta: these values are hard coded in the parser lol'''
position = "at"
target = "obj/GameManager.lua"

[[patches]]
[patches.regex]
pattern = '''imguiUniqueName, (?<param>numptr|event)'''
payload = '''label, $param'''
position = "at"
target = "obj/GameManager.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''
if properties.default then
		tooltip = tooltip .. '\nDefault value: ' .. tostring(properties.default)
end

helpers.imguiHelpMarker(tooltip)'''
payload = '''
if properties.default then
	tooltip = tooltip .. '\nDefault value: ' .. tostring(properties.default)
end
if mods.beattools.config.hideHelpMarkers then
	utilitools.imguiHelpers.tooltip(tooltip)
else helpers--[[stop wrong injection]].imguiHelpMarker(tooltip) end
'''
position = "at"
target = "obj/GameManager.lua"

# Charter fix ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''if not self.variant then
	self.level.metadata.charter = helpers.InputText("Charter", self.level.metadata.charter, 9999)
else'''
payload = '''
if mods.beattools.config.browserCharter or (not self.variant) then
	self.level.metadata.charter = self.level.metadata.charter or ""
	self.level.metadata.charter = helpers.InputText("Charter", self.level.metadata.charter, 9999)
	helpers.imguiHelpMarker("This is the name that will be displayed on the Beatblock Browser.")
end
if self.variant then
'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.regex]
pattern = '''self\.variant = \{ ?name = self\.newVariantName, display = self\.newVariantName, difficulty = 0, charter = '',slot ?=0 ?\}'''
payload = '''self.variant = { name = self.newVariantName, display = self.newVariantName, difficulty = 0, charter = mods.beattools.config.charter }'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''charter = 'Charter','''
payload = '''charter = mods.beattools.config.charter,'''
position = "at"
target = "obj/LevelManager.lua"

# Bookmark ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''
local prevBookmarkBeat = 0
local currBookmarkBeat = 0
'''
payload = '''
local prevBookmarkBeat = self.smallestBeat - (mods.beattools.config.scrollPast == 0 and 1 or mods.beattools.config.scrollPast)
local currBookmarkBeat = prevBookmarkBeat
local prevSectionName = "Start"
'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''prevBookmarkBeat = v.time'''
payload = '''prevSectionName = v.name'''
position = "after"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''return prevBookmarkBeat, currBookmarkBeat, nextBookmarkBeat, sectionName'''
payload = '''return prevBookmarkBeat, currBookmarkBeat, nextBookmarkBeat, sectionName, prevSectionName'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''local prevBookmarkBeat, currBookmarkBeat, nextBookmarkBeat, sectionName = self:findBookmarkBeats()'''
payload = '''local prevBookmarkBeat, currBookmarkBeat, nextBookmarkBeat, sectionName, prevSectionName = self:findBookmarkBeats()'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''local cAngle = 2 * math.pi * (self.editorBeat - currBookmarkBeat) / (nextBookmarkBeat - currBookmarkBeat)'''
payload = '''local cAngle = 2 * math.pi * (self.editorBeat - currBookmarkBeat) / (nextBookmarkBeat - currBookmarkBeat ~= 0 and nextBookmarkBeat - currBookmarkBeat or 1)'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''love.graphics.printf(sectionName, project.res.cx - 499, project.res.cy - 60, 1000, "center")'''
payload = '''
beattoolsGetCurrentEasing(self, "bookmarks", "bookmark", "editorBeat")
love.graphics.printf((mods.beattools.config.betterBookmarks and beattoolsCurrentEasings.editorBeat.bookmarks.runEvents - 1 ~= 0 and self.editorBeat == beattoolsCurrentEasings.editorBeat.bookmarks.time and prevSectionName .. " >> " or "") .. sectionName .. (mods.beattools.config.betterBookmarks and " (" .. (beattoolsCurrentEasings.editorBeat.bookmarks.runEvents - 1) .. "/" .. #(beattoolsEasings.bookmarks or {}) .. ")" or ""), project.res.cx - 499, project.res.cy - 60, 1000, "center")
if mods.beattools.config.betterBookmarks and beattoolsCurrentEasings.editorBeat.bookmarks.description ~= nil and beattoolsCurrentEasings.editorBeat.bookmarks.description ~= "" then
	love.graphics.printf(beattoolsCurrentEasings.editorBeat.bookmarks.description, project.res.cx - 499, project.res.cy + 60 - 10, 1000, "center")
end
'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''love.graphics.circle("fill", project.res.cx, project.res.cy, self:beatToRadius(self.editorBeat))'''
payload = '''
love.graphics.circle("fill", project.res.cx, project.res.cy, self:beatToRadius(self.editorBeat))
if mods.beattools.config.betterBookmarks then
	love.graphics.setColor(beattoolsCurrentEasings.editorBeat.bookmarks.r / 255, beattoolsCurrentEasings.editorBeat.bookmarks.g / 255, beattoolsCurrentEasings.editorBeat.bookmarks.b / 255, 1)
	love.graphics.arc("line", "open", project.res.cx, project.res.cy, self:beatToRadius(self.editorBeat), 0, 2 * math.pi, 100)
end
'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''local textWidth = love.graphics.getFont():getWidth(tostring(math.floor(self.editorBeat)))
love.graphics.draw(sprites.editor.beaticon, project.res.cx - textWidth / 2 - 5.5, project.res.cy - 5)'''
payload = '''
local beatText = tostring(math.floor(self.editorBeat))
local easingPrevBookmarkTime = beattoolsCurrentEasings.editorBeat.bookmarks.runEvents - 1 == 0 and 0 or beattoolsCurrentEasings.editorBeat.bookmarks.time
local bookmarkBeatText = math.floor(self.editorBeat - easingPrevBookmarkTime) .. "/" .. math.floor(nextBookmarkBeat - easingPrevBookmarkTime)
local textWidth = love.graphics.getFont():getWidth(beatText)
local bookmarkBeatTextWidth = love.graphics.getFont():getWidth(bookmarkBeatText)

if mods.beattools.config.betterBookmarks then
	love.graphics.setColor(beattoolsCurrentEasings.editorBeat.bookmarks.r / 255, beattoolsCurrentEasings.editorBeat.bookmarks.g / 255, beattoolsCurrentEasings.editorBeat.bookmarks.b / 255, 1)
	love.graphics.draw(sprites.editor.bookmarkicon, project.res.cx - bookmarkBeatTextWidth / 2 - 5.5, project.res.cy - 5 + 11)
end
'''
position = "at"
target = "states/Editor.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''love.graphics.printf(math.floor(self.editorBeat), project.res.cx - 18.5, project.res.cy - 7, 50, "center")'''
payload = '''
love.graphics.printf(beatText, project.res.cx - 18.5, project.res.cy - 7, 50, "center")
if mods.beattools.config.betterBookmarks then love.graphics.printf(bookmarkBeatText, project.res.cx - 18.5, project.res.cy - 7 + 11, 50, "center") end
'''
position = "at"
target = "states/Editor.lua"

# Suggest ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''Event.property(event,'string', 'var', 'Variable to ease (must be a child of cs)', {default = ''})'''
payload = '''event.var = utilitools.suggest.suggest(event.var, beattoolsOnlyEases)'''
position = "after"
target = "levelformat/events/Vfx/ease.lua"

[[patches]]
[patches.pattern]
match_indent = true
pattern = '''Event.property(event,'string', 'var', 'Variable to set (must be a child of cs)', {default = ''})'''
payload = '''event.var = utilitools.suggest.suggest(event.var, beattoolsOnlyBooleans)'''
position = "after"
target = "levelformat/events/Vfx/setBoolean.lua"

# Menu in editor ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== ===== =====
[[patches]]
[patches.pattern]
match_indent = true
pattern = '''if self.goToBeatDialogue then'''
payload = '''
if true then
	local configHelpers = utilitools.configHelpers
	local imguiHelpers = utilitools.imguiHelpers

	if mods.beattools.config.showEventGroups then
		if self.level then
			if self.level.properties.beattools == nil then self.level.properties.beattools = {} end
			if beattoolsHighestEventGroupIndex == -1 then
				if self.level.properties.beattools.eventGroups == nil then
					self.level.properties.beattools.eventGroups = helpers.copy(utilitools.files.beattools.configOptions.eventGroups.default)
				end
				beattoolsUpdateEventGroups()
			end
		end
		helpers.SetNextWindowPos(750, 420, "ImGuiCond_FirstUseEver")
		helpers.SetNextWindowSize(200, 300, "ImGuiCond_FirstUseEver")
		if imgui.Begin("Event Groups", nil, inputFlag) then
			if self.level then
				local function checkOverlapping(group, index)
					local overlapping = false
					if beattoolsEventIndices[index] then
						if beattoolsEventIndices[index].events.custom or group.events.custom then
							overlapping = true
						else
							for k, v in pairs(group.events) do
								if beattoolsEventIndices[index].events[k] then
									overlapping = true
									break
								end
							end
						end
					end
					return overlapping
				end
				if imgui.Button("Reset##EditorLayers") then
					if self.level.properties.beattools.customEventGroups then
						beattoolsMakeSpace(1, 3)
					end
					self.level.properties.beattools.eventGroups = helpers.copy(utilitools.files.beattools.configOptions.eventGroups.default)
					beattoolsUpdateEventGroups()
					if self.level.properties.beattools.customEventGroups then
						for k, v in pairs(self.level.properties.beattools.customEventGroups) do
							v.visibility = " - "
						end
						local i = 1
						while i <= beattoolsHighestEventGroupIndex do
							local v = beattoolsEventIndices[i]
							if v then
								while beattoolsEventIndices[i - 1] == nil and i > 1 do
									beattoolsMakeSpace(i, true)
									beattoolsUpdateEventGroups()
									i = i - 1
								end
							end
							i = i + 1
						end
					end
					changing = true
				end

				local changing = false
				if true then
					local buffer = ffi.new("char[?]", 256)
					ffi.copy(buffer, "Add Custom Group", #("Add Custom Group"))
					imgui.SetNextItemWidth(-1e-9)
					imgui.InputText("##addCustomEditorLayers", buffer, 256, 2^12)
					local value = ffi.string(buffer)
					if imgui.IsItemDeactivatedAfterEdit() and value and value ~= "" and value ~= "Add Custom Group" then
						if self.level.properties.beattools.customEventGroups == nil then self.level.properties.beattools.customEventGroups = {} end
						if self.level.properties.beattools.eventGroups[value] or self.level.properties.beattools.customEventGroups[value] then utilitools.prompts.error(mods.beattools, "Group name already exists") else
							self.level.properties.beattools.customEventGroups[value] = {
								events = { custom = true },
								visibility = " - ",
								index = #beattoolsEventIndices + 1
							}
							beattoolsUpdateEventGroups()
							changing = true
						end
					end
				end
				local indexGroup = 0
				for i, v in ipairs(beattoolsEventGroups) do
					if v.index ~= indexGroup then
						imgui.Separator()
						indexGroup = v.index
					end
					imgui.AlignTextToFramePadding()
					local currentPosition = imgui.GetCursorScreenPos()
					imgui.PushClipRect(imgui.ImVec2_Float(currentPosition.x, currentPosition.y), imgui.ImVec2_Float(currentPosition.x + beattoolsEventGroupLongest, currentPosition.y + 20), true)
					imgui.Text(v.name)
					imgui.PopClipRect()
					if v.name ~= "all" then
						if not changing and (v.index > 1 or beattoolsEventIndices[v.index].groups > 1) then
							imgui.SameLine(beattoolsEventGroupLongest + 10)
							if imgui.Button("^##" .. v.name .. "_editorLayers") then
								if beattoolsEventIndices[v.index].groups > 1 then
									beattoolsMakeSpace(v.index)
									v.index = v.index - 1
								else
									beattoolsMakeSpace(v.index, true)
									if checkOverlapping(v, v.index) then
										beattoolsMakeSpace(v.index)
										v.index = v.index - 1
									end
								end
								beattoolsUpdateEventGroups()
								changing = true
							end
						end
						if not changing and (beattoolsEventIndices[v.index + 1] or beattoolsEventIndices[v.index].groups > 1) then
							imgui.SameLine(beattoolsEventGroupLongest + 28)
							if imgui.Button("v##" .. v.name .. "_editorLayers") then
								if beattoolsEventIndices[v.index].groups > 1 then
									beattoolsMakeSpace(v.index + 1)
									v.index = v.index + 1
								else
									beattoolsMakeSpace(v.index + 1, true)
									if checkOverlapping(v, v.index + 1) then
										beattoolsMakeSpace(v.index + 1)
										v.index = v.index + 1
									end
								end
								beattoolsUpdateEventGroups()
								changing = true
							end
						end
						if not changing then
							imgui.SameLine(beattoolsEventGroupLongest + 46)
							local valptr = ffi.new("int[1]", { v.index })
							imgui.SetNextItemWidth(15)
							imgui.InputInt("##" .. v.name .. "_insertEditorLayers", valptr, 0, nil, 2^12)
							local value = valptr[0]
							if imgui.IsItemDeactivatedAfterEdit() and value and value ~= v.index then
								local origIndex = v.index
								if value < 1 then
									value = 1
								elseif value > #beattoolsEventIndices + 1 then
									value = #beattoolsEventIndices + 1
								end
								if checkOverlapping(v, value) then
									beattoolsMakeSpace(value)
								end
								v.index = value
								if beattoolsEventIndices[origIndex].groups <= 1 then
									beattoolsMakeSpace(origIndex + 1, true)
								end
								beattoolsUpdateEventGroups()
								changing = true
							end
						end
					end
					imgui.SameLine(beattoolsEventGroupLongest + 64)
					local isOpen = imgui.BeginCombo("##" .. v.name .. "_visibilityEditorLayers", v.visibility, 2^4 + 2^5 + 2^7)
					if isOpen then
						for i, vv in ipairs(v.name ~= "all" and { " - ", "show", "transparent", "ghost", "hide" } or { "show", "transparent", "ghost", "hide" }) do
							local selected = imgui.Selectable_Bool(vv, vv == v.visibility)
							if selected and vv ~= v.visibility then
								v.visibility = vv
								beattoolsEventVisibilities = {}
								self.selectedEvent = nil
								self.multiselect = nil

								self.multiselectStartBeat = nil
								self.multiselectEndBeat = nil
								self.multiselectStartAngle = nil
								self.multiselectEndAngle = nil
							end
						end
						imgui.EndCombo()
					end
					if v.events.custom then
						imgui.SameLine()
						if imgui.Button("Delete##" .. v.name .. "_deleteEditorLayers") then
							self.level.properties.beattools.customEventGroups[v.name] = nil
							local customEventsAmount = 0
							for k, v in pairs(self.level.properties.beattools.customEventGroups) do
								customEventsAmount = customEventsAmount + 1
							end
							if customEventsAmount == 0 then
								self.level.properties.beattools.customEventGroups = nil
							end
							beattoolsMakeSpace(v.index + 1, true)
							beattoolsUpdateEventGroups()
							changing = true
						end
					end
				end
			end
			imgui.End()
		end
	end
	if mods.beattools.config.easeList then
		helpers.SetNextWindowPos(750, 420, window_flag)
		helpers.SetNextWindowSize(200, 300, window_flag)
		if imgui.Begin("Ease List", nil, inputFlag) then
			if imgui.TreeNode_Str("Filters") then
				configHelpers.input("easeListUse")
				configHelpers.input("easeListUsed")
				configHelpers.input("easeListSerious")
				configHelpers.input("easeListSelectChanged")
				configHelpers.input("easeListSelected")
				configHelpers.input("easeListRound")
				configHelpers.input("easeListUsedVars")
				imgui.TreePop()
			end
			imgui.BeginTable("easeList", 2, imgui.ImGuiTableFlags_RowBg + imgui.ImGuiTableFlags_BordersInnerH + imgui.ImGuiTableFlags_BordersInnerV + imgui.ImGuiTableFlags_SizingFixedFit)
			for i, v in ipairs(beattoolsAllEasesSorted) do
				if ((not mods.beattools.config.easeListUse) or beattoolsUselessEases[v] == nil)
				and ((not mods.beattools.config.easeListSerious) or beattoolsTrollEases[v] == nil)
				and ((not mods.beattools.config.easeListSelected) or beattoolsEasesSelected[v]) then
					beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", v)
					if ((not mods.beattools.config.easeListUsed) or #(beattoolsEasings.ease[v] or {}) > 0)
					and ((not mods.beattools.config.easeListUsedVars) or v == "vfx.vars0" or v:sub(1, #"vfx.vars") ~= "vfx.vars" or #(beattoolsEasings.ease[v] or {}) > 0) then
						imgui.TableNextRow()
						imgui.TableNextColumn()

						local text
						if type(beattoolsAllEases[v]) == "boolean" then
							text = tostring(beattoolsCurrentEasings.editorBeat.ease[v].enable)
						elseif type(beattoolsAllEases[v]) == "number" or v == "outline" then
							if beattoolsCurrentEasings.editorBeat.ease[v].value == nil or not mods.beattools.config.easeListRound then
								text = tostring(beattoolsCurrentEasings.editorBeat.ease[v].value)
							else
								text = tostring(helpers.round(beattoolsCurrentEasings.editorBeat.ease[v].value * 1e3) / 1e3)
							end
						end
						if mods.beattools.config.easeListSelectChanged then
							beattoolsEasesSelected[v] = beattoolsCurrentEasings.editorBeat.ease[v][type(beattoolsAllEases[v]) == "boolean" and "enable" or "value"] ~= beattoolsAllEases[v] or nil
						end

						local pressed = imgui.Selectable_Bool(text, beattoolsEasesSelected[v], imgui.ImGuiSelectableFlags_SpanAllColumns)
						imguiHelpers.tooltip((beattoolsCurrentEasings.editorBeat.ease[v].runEvents - 1) .. "/" .. #(beattoolsEasings.ease[v] or {}) .. " events")

						if pressed then
							local function shouldSelect(v2)
								if v == "bgColor" and v2.type == "setBgColor" and v2.color ~= nil then return true end
								if v == "voidColor" and v2.type == "setBgColor" and v2.voidColor ~= nil then return true end
								if v == "outline" then return v2.type == "outline" and (v2.enable ~= nil or v2.color ~= nil) end
								if v == "vfx.bgNoise" and v2.type == "noise" and v2.chance ~= nil then return true end
								if v == "vfx.bgNoiseColor" and v2.type == "noise" and v2.color ~= nil then return true end
								if v:sub(1, 18) == "vfx.noteParticles." and v2.type == "toggleParticles" and v2[v:sub(19)] ~= nil then return true end
								return v2.type == (type(beattoolsAllEases[v]) == "boolean" and "setBoolean" or "ease") and v2.var == v
							end
							local eventsDeleted = 0
							if self.multiselect ~= nil then
								for i2 = #self.multiselect.events, 1, -1 do
									local v2 = self.multiselect.events[i2]
									if shouldSelect(v2) then
										table.remove(self.multiselect.events, i2)
										eventsDeleted = eventsDeleted + 1 + (v2.type == "ease" and v2.repeats and v2.repeats > 0 and (v2.repeatDelay or 1) ~= 0 and v2.repeats or 0)
									end
								end
							end
							local function addEases()
								if self.multiselect == nil then
									beattoolsNewMultiSelection()
									self.multiselectStartBeat = nil
									self.multiselectEndBeat = nil
								end
								local function addToMultiSelect(v2)
									table.insert(self.multiselect.events, v2)
									self.multiselect.eventTypes[v2.type] = true
									if self.multiselectStartBeat == nil then
										self.multiselectStartBeat = v2.time
										self.multiselectEndBeat = v2.time
									else
										if self.multiselectStartBeat > v2.time then
											self.multiselectStartBeat = v2.time
										end
										if self.multiselectEndBeat < v2.time then
											self.multiselectEndBeat = v2.time
										end
									end
								end
								if (self.selectedEvent and shouldSelect(self.selectedEvent)) or eventsDeleted == 1 or beattoolsCurrentEasings.editorBeat.ease[v].runEvents == 1 then
									for i2, v2 in ipairs(self.level.events) do
										if shouldSelect(v2) then addToMultiSelect(v2) end
									end
								elseif eventsDeleted == 0 then
									local v3
									for i2, v2 in ipairs(self.level.events) do
										if shouldSelect(v2) and v2.time <= self.editorBeat and (v3 == nil or v2.time > v3.time or (v2.time == v3.time and (v2.order or 0) >= (v3.order or 0))) then
											v3 = v2
										end
									end
									if v3 ~= nil then
										addToMultiSelect(v3)
									end
								end
								if self.multiselectStartBeat == nil then
									self.multiselectStartBeat = 0
									self.multiselectEndBeat = 360
								end

								self.p:hurtPulse()
							end
							if not mods.beattools.config.easeListSelectChanged then
								if beattoolsEasesSelected[v] and (#(beattoolsEasings.ease[v] or {}) == 0 or eventsDeleted == #(beattoolsEasings.ease[v] or {})) then
									beattoolsEasesSelected[v] = nil
								else
									beattoolsEasesSelected[v] = true
									if #(beattoolsEasings.ease[v] or {}) > 0 then addEases() end
								end
							elseif #(beattoolsEasings.ease[v] or {}) > 0 and (eventsDeleted == 0 or eventsDeleted ~= #(beattoolsEasings.ease[v] or {})) then
								addEases()
							end
						end
						if imgui.IsItemClicked(1) then
							log(mods.beattools, "Copied to clipboard: " .. text)
							love.system.setClipboardText(text)
							self.p:hurtPulse()
						end
						if imgui.IsItemClicked(2) then
							if type(beattoolsAllEases[v]) == "boolean" then
								self.placeEvent = "beattoolsEvent;setBoolean;var," .. v .. ",string;enable," .. text .. ",boolean"
							else
								self.placeEvent = "beattoolsEvent;ease;var," .. v .. ",string;value," .. text .. "," .. (type(beattoolsAllEases[v]) == "number" and "number" or "nil")
							end
						end

						imgui.TableNextColumn()
						if #(beattoolsEasings.ease[v] or {}) == 0 then
							imgui.TextDisabled(v)
						else
							imgui.Text(v)
						end
					end
				end
			end
			imgui.EndTable()

			imgui.End()
		end
	end
	if mods.beattools.config.bookmarkList then
		helpers.SetNextWindowPos(750, 420, "ImGuiCond_FirstUseEver")
		helpers.SetNextWindowSize(200, 300, "ImGuiCond_FirstUseEver")
		if imgui.Begin("Bookmarks", nil, inputFlag) then
			beattoolsGetCurrentEasing(self, "bookmarks", "bookmark", "editorBeat")
			for i, v in ipairs(beattoolsEasings.bookmarks) do
				if i ~= 1 then imgui.Separator() end
				imgui.ColorButton("", imgui.ImVec4_Float((v.r or 0) / 255, (v.g or 0) / 255, (v.b or 0) / 255, 1), 2^1, imgui.ImVec2_Float(20, 20))
				imgui.SameLine()
				local name = "Unnamed Bookmark"
				if v.name and v.name ~= "" then name = v.name end
				if imgui.Selectable_Bool(v.name .. " (Time: " .. (helpers.round(v.time * 1e3) / 1e3) .. ")", v.indexInLevel == beattoolsCurrentEasings.editorBeat.bookmarks.indexInLevel) then
					self.editorBeat = v.time
					self.selectedEvent = self.level.events[v.indexInLevel]
				end
				if v.description and v.description ~= "" then imgui.Indent() imgui.TextWrapped(v.description) imgui.Unindent() end
			end
			imgui.End()
		end
	end
	if mods.beattools.config.editorMenu or mods.beattools.config.colorPreview or mods.beattools.config.coordsDisplay then
		helpers.SetNextWindowPos(750, 420, window_flag)
		helpers.SetNextWindowSize(200, 300, window_flag)
		if imgui.Begin("Beattools", nil, inputFlag) then

			if mods.beattools.config.colorPreview then
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "bgColor")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "voidColor")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "outline")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "vfx.bgNoise")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "vfx.bgNoiseColor")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "vfx.hom")

				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "p.faceColor")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "p.fillColor")
				beattoolsGetCurrentEasing(self, "ease", "var", "editorBeat", "p.outlineColor")
				beattoolsGetCurrentEasing(self, "songNameOverride", "newname", "editorBeat")
				for i = 1, 8 do
					beattoolsGetCurrentEasing(self, "color", "r", "editorBeat", i, "r")
					beattoolsGetCurrentEasing(self, "color", "g", "editorBeat", i, "g")
					beattoolsGetCurrentEasing(self, "color", "b", "editorBeat", i, "b")

					local ColorButtonPos = imgui.GetCursorScreenPos()
					local additionalInfo = ""

					if not beattoolsCurrentEasings.editorBeat.ease["vfx.hom"].enable then
						if beattoolsCurrentEasings.editorBeat.ease.bgColor.value == i - 1 then
							additionalInfo = additionalInfo .. "\nBackground Color"
						end
						if beattoolsCurrentEasings.editorBeat.ease.voidColor.value == i - 1 then
							additionalInfo = additionalInfo .. "\nVoid Color"
						end
					end
					if beattoolsCurrentEasings.editorBeat.ease.outline.value ~= nil and beattoolsCurrentEasings.editorBeat.ease.outline.value == i - 1 then
						additionalInfo = additionalInfo .. "\nOutline"
					end
					if beattoolsCurrentEasings.editorBeat.ease["vfx.bgNoise"].value ~= 0 and beattoolsCurrentEasings.editorBeat.ease["vfx.bgNoiseColor"].value == i - 1 then
						additionalInfo = additionalInfo .. "\nNoise (" .. (helpers.round(beattoolsCurrentEasings.editorBeat.ease["vfx.bgNoise"].value * 1e3) / 1e1) .. "%)"
					end
					if beattoolsCurrentEasings.editorBeat.ease["p.faceColor"].value == i - 1 then
						additionalInfo = additionalInfo .. "\nPlayer Face Color"
					end
					if beattoolsCurrentEasings.editorBeat.ease["p.fillColor"].value == i - 1 then
						additionalInfo = additionalInfo .. "\nPlayer Fill Color"
					end
					if beattoolsCurrentEasings.editorBeat.ease["p.outlineColor"].value == i - 1 then
						additionalInfo = additionalInfo .. "\nPlayer Outline Color"
					end

					if imgui.ColorButton(
						"Color channel " .. i - 1 .. " (" .. (beattoolsCurrentEasings.editorBeat.color[i].r.runEvents - 1) .. "/" .. #(beattoolsEasings.color[i].r or {}) .. " " .. (beattoolsCurrentEasings.editorBeat.color[i].g.runEvents - 1) .. "/" .. #(beattoolsEasings.color[i].g or {}) .. " " .. (beattoolsCurrentEasings.editorBeat.color[i].b.runEvents - 1) .. "/" .. #(beattoolsEasings.color[i].b or {}) .. " - " .. (beattoolsEasings.color[i].eventAmount or 0) .. " events)" .. additionalInfo,
						imgui.ImVec4_Float(
							(beattoolsCurrentEasings.editorBeat.color[i].r.r or 0) / 255,
							(beattoolsCurrentEasings.editorBeat.color[i].g.g or 0) / 255,
							(beattoolsCurrentEasings.editorBeat.color[i].b.b or 0) / 255,
							1
						),
						2^1,
						imgui.ImVec2_Float(20, 20)
					) then
						forceprint("pressed")
						local function shouldSelect(v2)
							return v2.type == "setColor" and v2.color == i - 1
						end
						local eventsDeleted = 0
						if self.multiselect ~= nil then
							for i2 = #self.multiselect.events, 1, -1 do
								local v2 = self.multiselect.events[i2]
								if shouldSelect(v2) then
									table.remove(self.multiselect.events, i2)
									eventsDeleted = eventsDeleted + 1
								end
							end
						end
						local function addEases()
							if self.multiselect == nil then
								beattoolsNewMultiSelection()
								self.multiselectStartBeat = nil
								self.multiselectEndBeat = nil
							end
							local function addToMultiSelect(v2)
								table.insert(self.multiselect.events, v2)
								self.multiselect.eventTypes[v2.type] = true
								if self.multiselectStartBeat == nil then
									self.multiselectStartBeat = v2.time
									self.multiselectEndBeat = v2.time
								else
									if self.multiselectStartBeat > v2.time then
										self.multiselectStartBeat = v2.time
									end
									if self.multiselectEndBeat < v2.time then
										self.multiselectEndBeat = v2.time
									end
								end
							end
							if (self.selectedEvent and shouldSelect(self.selectedEvent)) or eventsDeleted == 1 or beattoolsCurrentEasings.editorBeat.color[i].runEvents == 1 then
								for i2, v2 in ipairs(self.level.events) do
									if shouldSelect(v2) then addToMultiSelect(v2) end
								end
							elseif eventsDeleted == 0 then
								local v3
								for i2, v2 in ipairs(self.level.events) do
									if shouldSelect(v2) and v2.time <= self.editorBeat and (v3 == nil or v2.time > v3.time or (v2.time == v3.time and (v2.order or 0) >= (v3.order or 0))) then
										v3 = v2
									end
								end
								if v3 ~= nil then
									addToMultiSelect(v3)
								end
							end
							if self.multiselectStartBeat == nil then
								self.multiselectStartBeat = 0
								self.multiselectEndBeat = 360
							end

							self.p:hurtPulse()
						end
						if (beattoolsEasings.color[i].eventAmount or 0) > 0 and (eventsDeleted == 0 or eventsDeleted ~= (beattoolsEasings.color[i].eventAmount or 0)) then
							addEases()
						end
					end
					if imgui.IsItemClicked(1) then
						local hex = beattoolsRGB2Hex(beattoolsCurrentEasings.editorBeat.color[i].r.r, beattoolsCurrentEasings.editorBeat.color[i].g.g, beattoolsCurrentEasings.editorBeat.color[i].b.b)
						log(mods.beattools, "Copied to clipboard: " .. hex)
						love.system.setClipboardText(hex)
						self.p:hurtPulse()
					end
					if imgui.IsItemClicked(2) then
						self.placeEvent = "beattoolsEvent;setColor;color," .. i - 1 .. ",number;r," .. beattoolsCurrentEasings.editorBeat.color[i].r.r .. ",number;g," .. beattoolsCurrentEasings.editorBeat.color[i].g.g .. ",number;b," .. beattoolsCurrentEasings.editorBeat.color[i].b.b .. ",number"
					end

					if mods.beattools.config.colorEasePreview then
						if not beattoolsCurrentEasings.editorBeat.ease["vfx.hom"].enable then
							if beattoolsCurrentEasings.editorBeat.ease.bgColor.value == i - 1 then
								imgui.SetCursorScreenPos(imgui.ImVec2_Float(ColorButtonPos.x, ColorButtonPos.y))
								imgui.Image(sprites.editor.events.setbgcolor, imgui.ImVec2_Float(10, 10))
							end
							if beattoolsCurrentEasings.editorBeat.ease.voidColor.value == i - 1 then
								imgui.SetCursorScreenPos(imgui.ImVec2_Float(ColorButtonPos.x + 10, ColorButtonPos.y))
								imgui.Image(sprites.editor.events.setbgcolor, imgui.ImVec2_Float(10, 10), nil, nil, imgui.ImVec4_Float(1, 1, 1, 0.5))
							end
						end
						if beattoolsCurrentEasings.editorBeat.ease.outline.value ~= nil and beattoolsCurrentEasings.editorBeat.ease.outline.value == i - 1 then
							imgui.SetCursorScreenPos(imgui.ImVec2_Float(ColorButtonPos.x, ColorButtonPos.y + 10))
							imgui.Image(sprites.editor.events.outline, imgui.ImVec2_Float(10, 10))
						end
						if beattoolsCurrentEasings.editorBeat.ease["vfx.bgNoise"].value ~= 0 and beattoolsCurrentEasings.editorBeat.ease["vfx.bgNoiseColor"].value == i - 1 then
							imgui.SetCursorScreenPos(imgui.ImVec2_Float(ColorButtonPos.x + 10, ColorButtonPos.y + 10))
							imgui.Image(sprites.editor.events.noise, imgui.ImVec2_Float(10, 10))
						end
					end

					imgui.SetCursorScreenPos(imgui.ImVec2_Float(ColorButtonPos.x + 25, ColorButtonPos.y))
				end
				imgui.SameLine()
				local additionalInfo = ""
				if beattoolsCurrentEasings.editorBeat.ease["p.faceColor"].value == -1 then
					if additionalInfo ~= "" then additionalInfo = additionalInfo .. "\n" end
					additionalInfo = additionalInfo ..  "Player Face Color (Original Face Colors)"
				end
				if beattoolsCurrentEasings.editorBeat.songNameOverride.newname then
					if additionalInfo ~= "" then additionalInfo = additionalInfo .. "\n" end
					additionalInfo = additionalInfo ..  "Song Name (" .. beattoolsCurrentEasings.editorBeat.songNameOverride.newname .. ")"
				end
				if additionalInfo ~= "" then
					imgui.Text("[+]")
					imguiHelpers.tooltip(additionalInfo)
				else
					imgui.NewLine()
				end
			end
			if mods.beattools.config.coordsDisplay then
				imgui.TextUnformatted("X/Y: " .. helpers.round(mouse.rx) .. "/" ..  helpers.round(mouse.ry))
			end
			if mods.beattools.config.editorMenu then
				if utilitools.files.beattools.config then utilitools.files.beattools.config() end
				if self.zoom then
					if self.zoom < mods.beattools.config.zoomMin then self.zoom = mods.beattools.config.zoomMin end
					if self.zoom > mods.beattools.config.zoomMax then self.zoom = mods.beattools.config.zoomMax end
					self.drawDistance = mods.beattools.config.editorBeats
					self.angleSnapValues = mods.beattools.config.angleSnapValues
					self.beatSnapValues = mods.beattools.config.beatSnapValues
				end
			end

			imgui.End()
		end
	end
	if mods.beattools.config.imguiGuide then
		helpers.SetNextWindowPos(750, 420, window_flag)
		helpers.SetNextWindowSize(200, 300, window_flag)
		imgui.ShowDemoWindow()
	end
	if mods.beattools.config.editorCalculator then
		if utilitools.files.beattools.calculator then utilitools.files.beattools.calculator() end
	end
end
'''
position = "before"
target = "states/Editor.lua"
